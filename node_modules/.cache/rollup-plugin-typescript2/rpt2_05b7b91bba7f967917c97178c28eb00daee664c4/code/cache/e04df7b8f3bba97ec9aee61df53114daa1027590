{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Bond, Vec2, bondChangingAction, fromBondAddition, fromBondsAttrs, FunctionalGroup, SGroup, fromOneBondDeletion } from 'ketcher-core';\r\nimport utils from '../shared/utils';\r\nclass BondTool {\r\n    editor;\r\n    atomProps;\r\n    bondProps;\r\n    dragCtx;\r\n    isNotActiveTool;\r\n    constructor(editor, bondProps) {\r\n        this.editor = editor;\r\n        this.atomProps = { label: 'C' };\r\n        this.bondProps = bondProps;\r\n        if (editor.selection() && editor.selection()?.bonds) {\r\n            const action = fromBondsAttrs(editor.render.ctab, editor.selection().bonds, bondProps);\r\n            editor.update(action);\r\n            editor.selection(null);\r\n            this.isNotActiveTool = true;\r\n        }\r\n    }\r\n    mousedown(event) {\r\n        if (this.dragCtx)\r\n            return;\r\n        const struct = this.editor.render.ctab;\r\n        const molecule = struct.molecule;\r\n        const functionalGroups = molecule.functionalGroups;\r\n        const ci = this.editor.findItem(event, ['atoms', 'bonds']);\r\n        const atomResult = [];\r\n        const bondResult = [];\r\n        const result = [];\r\n        if (ci && functionalGroups.size && ci.map === 'atoms') {\r\n            const atomId = FunctionalGroup.atomsInFunctionalGroup(functionalGroups, ci.id);\r\n            if (atomId !== null)\r\n                atomResult.push(atomId);\r\n        }\r\n        if (ci && functionalGroups.size && ci.map === 'bonds') {\r\n            const bondId = FunctionalGroup.bondsInFunctionalGroup(molecule, functionalGroups, ci.id);\r\n            if (bondId !== null)\r\n                bondResult.push(bondId);\r\n        }\r\n        if (atomResult.length > 0) {\r\n            for (const id of atomResult) {\r\n                const fgId = FunctionalGroup.findFunctionalGroupByAtom(functionalGroups, id);\r\n                if (fgId !== null && !result.includes(fgId)) {\r\n                    result.push(fgId);\r\n                }\r\n            }\r\n            this.editor.event.removeFG.dispatch({ fgIds: result });\r\n            return;\r\n        }\r\n        else if (bondResult.length > 0) {\r\n            for (const id of bondResult) {\r\n                const fgId = FunctionalGroup.findFunctionalGroupByBond(molecule, functionalGroups, id);\r\n                if (fgId !== null && !result.includes(fgId)) {\r\n                    result.push(fgId);\r\n                }\r\n            }\r\n            this.editor.event.removeFG.dispatch({ fgIds: result });\r\n            return;\r\n        }\r\n        const rnd = this.editor.render;\r\n        this.editor.hover(null);\r\n        this.editor.selection(null);\r\n        this.dragCtx = {\r\n            xy0: rnd.page2obj(event),\r\n            item: this.editor.findItem(event, ['atoms', 'bonds'])\r\n        };\r\n        if (!this.dragCtx.item)\r\n            // ci.type == 'Canvas'\r\n            delete this.dragCtx.item;\r\n        return true;\r\n    }\r\n    mousemove(event) {\r\n        const struct = this.editor.render.ctab;\r\n        const sgroups = struct.sgroups;\r\n        const molecule = struct.molecule;\r\n        const functionalGroups = molecule.functionalGroups;\r\n        const editor = this.editor;\r\n        const rnd = editor.render;\r\n        if ('dragCtx' in this) {\r\n            const dragCtx = this.dragCtx;\r\n            const pos = rnd.page2obj(event);\r\n            let angle = utils.calcAngle(dragCtx.xy0, pos);\r\n            if (!event.ctrlKey)\r\n                angle = utils.fracAngle(angle, null);\r\n            const degrees = utils.degrees(angle);\r\n            this.editor.event.message.dispatch({ info: degrees + 'ยบ' });\r\n            if (!('item' in dragCtx) || dragCtx.item.map === 'atoms') {\r\n                if ('action' in dragCtx)\r\n                    dragCtx.action.perform(rnd.ctab);\r\n                let beginAtom;\r\n                let endAtom;\r\n                let beginPos;\r\n                let endPos;\r\n                const extraNeighbour = [];\r\n                if ('item' in dragCtx && dragCtx.item.map === 'atoms') {\r\n                    // first mousedown event intersect with any atom\r\n                    beginAtom = dragCtx.item.id;\r\n                    endAtom = editor.findItem(event, ['atoms'], dragCtx.item);\r\n                    const closestSGroup = editor.findItem(event, ['functionalGroups']);\r\n                    if (closestSGroup &&\r\n                        FunctionalGroup.isContractedFunctionalGroup(closestSGroup.id, functionalGroups)) {\r\n                        const sGroup = sgroups.get(closestSGroup.id);\r\n                        const sGroupAtoms = SGroup.getAtoms(molecule, sGroup?.item);\r\n                        endAtom = {\r\n                            id: sGroupAtoms[0],\r\n                            map: 'atoms'\r\n                        };\r\n                    }\r\n                    const fGroupId = endAtom &&\r\n                        FunctionalGroup.findFunctionalGroupByAtom(functionalGroups, endAtom.id);\r\n                    const fGroup = typeof fGroupId === 'number' && sgroups.get(fGroupId);\r\n                    const fGroupAtoms = fGroup && SGroup.getAtoms(molecule, fGroup.item);\r\n                    if (endAtom && fGroup && endAtom.id !== fGroupAtoms?.[0]) {\r\n                        this.editor.event.removeFG.dispatch({ fgIds: [fGroupId] });\r\n                        endAtom = null;\r\n                    }\r\n                    if (endAtom && fGroup && endAtom.id === fGroupAtoms?.[0]) {\r\n                        const atomNeighbours = molecule.atomGetNeighbors(endAtom.id);\r\n                        atomNeighbours?.forEach((nei) => {\r\n                            !fGroupAtoms?.includes(nei.aid) &&\r\n                                !extraNeighbour.includes(nei.aid) &&\r\n                                extraNeighbour.push(nei.aid);\r\n                        });\r\n                    }\r\n                    if (extraNeighbour.length >= 1) {\r\n                        endAtom = null;\r\n                    }\r\n                }\r\n                else {\r\n                    // first mousedown event intersect with any canvas\r\n                    beginAtom = this.atomProps;\r\n                    beginPos = dragCtx.xy0;\r\n                    endAtom = editor.findItem(event, ['atoms']);\r\n                    const atomResult = [];\r\n                    const result = [];\r\n                    if (endAtom &&\r\n                        endAtom.map === 'atoms' &&\r\n                        functionalGroups.size &&\r\n                        this.dragCtx) {\r\n                        const atomId = FunctionalGroup.atomsInFunctionalGroup(functionalGroups, endAtom.id);\r\n                        if (atomId !== null)\r\n                            atomResult.push(atomId);\r\n                    }\r\n                    if (atomResult.length > 0) {\r\n                        for (const id of atomResult) {\r\n                            const fgId = FunctionalGroup.findFunctionalGroupByAtom(functionalGroups, id);\r\n                            fgId !== null && !result.includes(fgId) && result.push(fgId);\r\n                        }\r\n                    }\r\n                    if (result.length > 0) {\r\n                        this.editor.event.removeFG.dispatch({ fgIds: result });\r\n                        delete this.dragCtx;\r\n                        return;\r\n                    }\r\n                }\r\n                let dist = Number.MAX_VALUE;\r\n                if (endAtom?.map === 'atoms') {\r\n                    // after mousedown events is appered, cursor is moved and then cursor intersects any atoms\r\n                    endAtom = endAtom.id;\r\n                }\r\n                else {\r\n                    endAtom = this.atomProps;\r\n                    const xy1 = rnd.page2obj(event);\r\n                    dist = Vec2.dist(dragCtx.xy0, xy1);\r\n                    if (beginPos) {\r\n                        // rotation only, leght of bond = 1;\r\n                        endPos = utils.calcNewAtomPos(beginPos, xy1, event.ctrlKey);\r\n                    }\r\n                    else {\r\n                        // first mousedown event intersect with any atom and\r\n                        // rotation only, leght of bond = 1;\r\n                        const atom = rnd.ctab.molecule.atoms.get(beginAtom);\r\n                        beginPos = utils.calcNewAtomPos(atom?.pp.get_xy0(), xy1, event.ctrlKey);\r\n                    }\r\n                }\r\n                // don't rotate the bond if the distance between the start and end point is too small\r\n                if (dist > 0.3) {\r\n                    const [existingBondId, bond] = this.getExistingBond(molecule, beginAtom, endAtom);\r\n                    dragCtx.action = fromBondAddition(rnd.ctab, this.bondProps, beginAtom, endAtom, beginPos, endPos)[0];\r\n                    if (existingBondId !== null) {\r\n                        this.dragCtx.existedBond = bond;\r\n                        this.dragCtx.action.mergeWith(fromOneBondDeletion(rnd.ctab, existingBondId));\r\n                    }\r\n                }\r\n                else {\r\n                    delete dragCtx.action;\r\n                }\r\n                this.restoreBondWhenHoveringOnCanvas(event);\r\n                this.editor.update(dragCtx.action, true);\r\n                return true;\r\n            }\r\n        }\r\n        this.editor.hover(this.editor.findItem(event, ['atoms', 'bonds']), null, event);\r\n        return true;\r\n    }\r\n    mouseup(event) {\r\n        if ('dragCtx' in this) {\r\n            const dragCtx = this.dragCtx;\r\n            const rnd = this.editor.render;\r\n            const struct = rnd.ctab.molecule;\r\n            if ('action' in dragCtx) {\r\n                this.restoreBondWhenHoveringOnCanvas(event);\r\n                this.editor.update(dragCtx.action);\r\n            }\r\n            else if (!('item' in dragCtx)) {\r\n                const xy = rnd.page2obj(event);\r\n                const v = new Vec2(1.0 / 2, 0).rotate(this.bondProps.type === Bond.PATTERN.TYPE.SINGLE ? -Math.PI / 6 : 0);\r\n                const bondAddition = fromBondAddition(rnd.ctab, this.bondProps, { label: 'C' }, { label: 'C' }, Vec2.diff(xy, v), Vec2.sum(xy, v));\r\n                this.editor.update(bondAddition[0]);\r\n            }\r\n            else if (dragCtx.item.map === 'atoms') {\r\n                // click on atom\r\n                this.editor.update(fromBondAddition(rnd.ctab, this.bondProps, dragCtx.item.id, undefined)[0]);\r\n                delete this.dragCtx.existedBond;\r\n            }\r\n            else if (dragCtx.item.map === 'bonds') {\r\n                const bondProps = Object.assign({}, this.bondProps);\r\n                const bond = struct.bonds.get(dragCtx.item.id);\r\n                this.editor.update(bondChangingAction(rnd.ctab, dragCtx.item.id, bond, bondProps));\r\n            }\r\n            delete this.dragCtx;\r\n        }\r\n        this.editor.event.message.dispatch({\r\n            info: false\r\n        });\r\n        this.editor.hover(this.editor.findItem(event, ['atoms', 'bonds']), null, event);\r\n        return true;\r\n    }\r\n    /*\r\n      If we want to add a new bond, we need to delete previous one\r\n      But we can change our mind, then deleted bond needs to be restored\r\n    */\r\n    restoreBondWhenHoveringOnCanvas(event) {\r\n        if (!this.dragCtx.existedBond) {\r\n            return;\r\n        }\r\n        const isHoveringOverAtom = this.editor.findItem(event, ['atoms']);\r\n        if (!isHoveringOverAtom) {\r\n            const { begin, end } = this.dragCtx.existedBond;\r\n            const bondEnd = this.dragCtx.item.id === begin ? end : begin;\r\n            this.dragCtx.action.mergeWith(fromBondAddition(this.editor.render.ctab, this.dragCtx.existedBond, this.dragCtx.item.id, bondEnd)[0]);\r\n            delete this.dragCtx.existedBond;\r\n        }\r\n    }\r\n    getExistingBond(struct, begin, end) {\r\n        for (const [bondId, bond] of struct.bonds.entries()) {\r\n            const alreadyHasBondInOtherDirection = (bond.begin === end && bond.end === begin) ||\r\n                (bond.begin === begin && bond.end === end);\r\n            if (alreadyHasBondInOtherDirection) {\r\n                return [bondId, bond];\r\n            }\r\n        }\r\n        return [null, null];\r\n    }\r\n}\r\nexport default BondTool;\r\n//# sourceMappingURL=bond.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/shared/utils.js","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/Editor.ts"],"map":"{\"version\":3,\"file\":\"bond.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/script/editor/tool/bond.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;;;;6EAc6E;AAE7E,OAAO,EACL,IAAI,EACJ,IAAI,EACJ,kBAAkB,EAClB,gBAAgB,EAChB,cAAc,EACd,eAAe,EACf,MAAM,EACN,mBAAmB,EAEpB,MAAM,cAAc,CAAA;AAErB,OAAO,KAAK,MAAM,iBAAiB,CAAA;AAGnC,MAAM,QAAQ;IACZ,MAAM,CAAQ;IACd,SAAS,CAAmB;IAC5B,SAAS,CAAK;IACd,OAAO,CAAK;IACZ,eAAe,CAAqB;IAEpC,YAAY,MAAM,EAAE,SAAS;QAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;QACpB,IAAI,CAAC,SAAS,GAAG,EAAE,KAAK,EAAE,GAAG,EAAE,CAAA;QAC/B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAA;QAC1B,IAAI,MAAM,CAAC,SAAS,EAAE,IAAI,MAAM,CAAC,SAAS,EAAE,EAAE,KAAK,EAAE;YACnD,MAAM,MAAM,GAAG,cAAc,CAC3B,MAAM,CAAC,MAAM,CAAC,IAAI,EAClB,MAAM,CAAC,SAAS,EAAE,CAAC,KAAK,EACxB,SAAS,CACV,CAAA;YACD,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;YACrB,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;YACtB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAA;SAC5B;IACH,CAAC;IAED,SAAS,CAAC,KAAK;QACb,IAAI,IAAI,CAAC,OAAO;YAAE,OAAM;QACxB,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAA;QACtC,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAA;QAChC,MAAM,gBAAgB,GAAG,QAAQ,CAAC,gBAAgB,CAAA;QAClD,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,CAAA;QAC1D,MAAM,UAAU,GAAkB,EAAE,CAAA;QACpC,MAAM,UAAU,GAAkB,EAAE,CAAA;QACpC,MAAM,MAAM,GAAkB,EAAE,CAAA;QAChC,IAAI,EAAE,IAAI,gBAAgB,CAAC,IAAI,IAAI,EAAE,CAAC,GAAG,KAAK,OAAO,EAAE;YACrD,MAAM,MAAM,GAAG,eAAe,CAAC,sBAAsB,CACnD,gBAAgB,EAChB,EAAE,CAAC,EAAE,CACN,CAAA;YACD,IAAI,MAAM,KAAK,IAAI;gBAAE,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SAC7C;QACD,IAAI,EAAE,IAAI,gBAAgB,CAAC,IAAI,IAAI,EAAE,CAAC,GAAG,KAAK,OAAO,EAAE;YACrD,MAAM,MAAM,GAAG,eAAe,CAAC,sBAAsB,CACnD,QAAQ,EACR,gBAAgB,EAChB,EAAE,CAAC,EAAE,CACN,CAAA;YACD,IAAI,MAAM,KAAK,IAAI;gBAAE,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SAC7C;QACD,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACzB,KAAK,MAAM,EAAE,IAAI,UAAU,EAAE;gBAC3B,MAAM,IAAI,GAAG,eAAe,CAAC,yBAAyB,CACpD,gBAAgB,EAChB,EAAE,CACH,CAAA;gBACD,IAAI,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;oBAC3C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;iBAClB;aACF;YACD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAA;YACtD,OAAM;SACP;aAAM,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YAChC,KAAK,MAAM,EAAE,IAAI,UAAU,EAAE;gBAC3B,MAAM,IAAI,GAAG,eAAe,CAAC,yBAAyB,CACpD,QAAQ,EACR,gBAAgB,EAChB,EAAE,CACH,CAAA;gBACD,IAAI,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE;oBAC3C,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;iBAClB;aACF;YACD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAA;YACtD,OAAM;SACP;QACD,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA;QAC9B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QACvB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;QAC3B,IAAI,CAAC,OAAO,GAAG;YACb,GAAG,EAAE,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC;YACxB,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;SACtD,CAAA;QACD,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI;YACpB,sBAAsB;YACtB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,CAAA;QAC1B,OAAO,IAAI,CAAA;IACb,CAAC;IAED,SAAS,CAAC,KAAK;QACb,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAA;QACtC,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAA;QAC9B,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAA;QAChC,MAAM,gBAAgB,GAAG,QAAQ,CAAC,gBAAgB,CAAA;QAClD,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;QAC1B,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAA;QACzB,IAAI,SAAS,IAAI,IAAI,EAAE;YACrB,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAA;YAE5B,MAAM,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA;YAC/B,IAAI,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;YAC7C,IAAI,CAAC,KAAK,CAAC,OAAO;gBAAE,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;YAExD,MAAM,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;YACpC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,GAAG,GAAG,EAAE,CAAC,CAAA;YAE3D,IAAI,CAAC,CAAC,MAAM,IAAI,OAAO,CAAC,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE;gBACxD,IAAI,QAAQ,IAAI,OAAO;oBAAE,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;gBACzD,IAAI,SAAS,CAAA;gBACb,IAAI,OAAO,CAAA;gBACX,IAAI,QAAQ,CAAA;gBACZ,IAAI,MAAM,CAAA;gBACV,MAAM,cAAc,GAAkB,EAAE,CAAA;gBACxC,IAAI,MAAM,IAAI,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE;oBACrD,gDAAgD;oBAChD,SAAS,GAAG,OAAO,CAAC,IAAI,CAAC,EAAE,CAAA;oBAC3B,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,EAAE,OAAO,CAAC,IAAI,CAAC,CAAA;oBACzD,MAAM,aAAa,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,kBAAkB,CAAC,CAAC,CAAA;oBAClE,IACE,aAAa;wBACb,eAAe,CAAC,2BAA2B,CACzC,aAAa,CAAC,EAAE,EAChB,gBAAgB,CACjB,EACD;wBACA,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAA;wBAC5C,MAAM,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,CAAC,CAAA;wBAC3D,OAAO,GAAG;4BACR,EAAE,EAAE,WAAW,CAAC,CAAC,CAAC;4BAClB,GAAG,EAAE,OAAO;yBACb,CAAA;qBACF;oBACD,MAAM,QAAQ,GACZ,OAAO;wBACP,eAAe,CAAC,yBAAyB,CACvC,gBAAgB,EAChB,OAAO,CAAC,EAAE,CACX,CAAA;oBACH,MAAM,MAAM,GAAG,OAAO,QAAQ,KAAK,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;oBACpE,MAAM,WAAW,GACf,MAAM,IAAK,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAS,CAAA;oBAC3D,IAAI,OAAO,IAAI,MAAM,IAAI,OAAO,CAAC,EAAE,KAAK,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE;wBACxD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAA;wBAC1D,OAAO,GAAG,IAAI,CAAA;qBACf;oBACD,IAAI,OAAO,IAAI,MAAM,IAAI,OAAO,CAAC,EAAE,KAAK,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE;wBACxD,MAAM,cAAc,GAAG,QAAQ,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAA;wBAC5D,cAAc,EAAE,OAAO,CAAC,CAAC,GAAG,EAAE,EAAE;4BAC9B,CAAC,WAAW,EAAE,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC;gCAC7B,CAAC,cAAc,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC;gCACjC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;wBAChC,CAAC,CAAC,CAAA;qBACH;oBACD,IAAI,cAAc,CAAC,MAAM,IAAI,CAAC,EAAE;wBAC9B,OAAO,GAAG,IAAI,CAAA;qBACf;iBACF;qBAAM;oBACL,kDAAkD;oBAClD,SAAS,GAAG,IAAI,CAAC,SAAS,CAAA;oBAC1B,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAA;oBACtB,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;oBAC3C,MAAM,UAAU,GAAkB,EAAE,CAAA;oBACpC,MAAM,MAAM,GAAkB,EAAE,CAAA;oBAChC,IACE,OAAO;wBACP,OAAO,CAAC,GAAG,KAAK,OAAO;wBACvB,gBAAgB,CAAC,IAAI;wBACrB,IAAI,CAAC,OAAO,EACZ;wBACA,MAAM,MAAM,GAAG,eAAe,CAAC,sBAAsB,CACnD,gBAAgB,EAChB,OAAO,CAAC,EAAE,CACX,CAAA;wBACD,IAAI,MAAM,KAAK,IAAI;4BAAE,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;qBAC7C;oBACD,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;wBACzB,KAAK,MAAM,EAAE,IAAI,UAAU,EAAE;4BAC3B,MAAM,IAAI,GAAG,eAAe,CAAC,yBAAyB,CACpD,gBAAgB,EAChB,EAAE,CACH,CAAA;4BACD,IAAI,KAAK,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;yBAC7D;qBACF;oBACD,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;wBACrB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAA;wBACtD,OAAO,IAAI,CAAC,OAAO,CAAA;wBACnB,OAAM;qBACP;iBACF;gBACD,IAAI,IAAI,GAAG,MAAM,CAAC,SAAS,CAAA;gBAC3B,IAAI,OAAO,EAAE,GAAG,KAAK,OAAO,EAAE;oBAC5B,0FAA0F;oBAC1F,OAAO,GAAG,OAAO,CAAC,EAAE,CAAA;iBACrB;qBAAM;oBACL,OAAO,GAAG,IAAI,CAAC,SAAS,CAAA;oBACxB,MAAM,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA;oBAC/B,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAA;oBAClC,IAAI,QAAQ,EAAE;wBACZ,oCAAoC;wBACpC,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,QAAQ,EAAE,GAAG,EAAE,KAAK,CAAC,OAAO,CAAC,CAAA;qBAC5D;yBAAM;wBACL,oDAAoD;wBACpD,oCAAoC;wBACpC,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;wBACnD,QAAQ,GAAG,KAAK,CAAC,cAAc,CAC7B,IAAI,EAAE,EAAE,CAAC,OAAO,EAAE,EAClB,GAAG,EACH,KAAK,CAAC,OAAO,CACd,CAAA;qBACF;iBACF;gBACD,qFAAqF;gBACrF,IAAI,IAAI,GAAG,GAAG,EAAE;oBACd,MAAM,CAAC,cAAc,EAAE,IAAI,CAAC,GAAG,IAAI,CAAC,eAAe,CACjD,QAAQ,EACR,SAAS,EACT,OAAO,CACR,CAAA;oBACD,OAAO,CAAC,MAAM,GAAG,gBAAgB,CAC/B,GAAG,CAAC,IAAI,EACR,IAAI,CAAC,SAAS,EACd,SAAS,EACT,OAAO,EACP,QAAQ,EACR,MAAM,CACP,CAAC,CAAC,CAAC,CAAA;oBACJ,IAAI,cAAc,KAAK,IAAI,EAAE;wBAC3B,IAAI,CAAC,OAAO,CAAC,WAAW,GAAG,IAAI,CAAA;wBAC/B,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAC3B,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,cAAc,CAAC,CAC9C,CAAA;qBACF;iBACF;qBAAM;oBACL,OAAO,OAAO,CAAC,MAAM,CAAA;iBACtB;gBACD,IAAI,CAAC,+BAA+B,CAAC,KAAK,CAAC,CAAA;gBAC3C,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;gBACxC,OAAO,IAAI,CAAA;aACZ;SACF;QACD,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,EAC/C,IAAI,EACJ,KAAK,CACN,CAAA;QACD,OAAO,IAAI,CAAA;IACb,CAAC;IAED,OAAO,CAAC,KAAK;QACX,IAAI,SAAS,IAAI,IAAI,EAAE;YACrB,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAA;YAC5B,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA;YAC9B,MAAM,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAA;YAChC,IAAI,QAAQ,IAAI,OAAO,EAAE;gBACvB,IAAI,CAAC,+BAA+B,CAAC,KAAK,CAAC,CAAA;gBAC3C,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;aACnC;iBAAM,IAAI,CAAC,CAAC,MAAM,IAAI,OAAO,CAAC,EAAE;gBAC/B,MAAM,EAAE,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAA;gBAC9B,MAAM,CAAC,GAAG,IAAI,IAAI,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CACnC,IAAI,CAAC,SAAS,CAAC,IAAI,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CACpE,CAAA;gBACD,MAAM,YAAY,GAAG,gBAAgB,CACnC,GAAG,CAAC,IAAI,EACR,IAAI,CAAC,SAAS,EACd,EAAE,KAAK,EAAE,GAAG,EAAE,EACd,EAAE,KAAK,EAAE,GAAG,EAAE,EACd,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,EAChB,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC,CAChB,CAAA;gBAED,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAA;aACpC;iBAAM,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE;gBACvC,gBAAgB;gBAChB,IAAI,CAAC,MAAM,CAAC,MAAM,CAChB,gBAAgB,CACd,GAAG,CAAC,IAAI,EACR,IAAI,CAAC,SAAS,EACd,OAAO,CAAC,IAAI,CAAC,EAAE,EACf,SAAS,CACV,CAAC,CAAC,CAAC,CACL,CAAA;gBACD,OAAO,IAAI,CAAC,OAAO,CAAC,WAAW,CAAA;aAChC;iBAAM,IAAI,OAAO,CAAC,IAAI,CAAC,GAAG,KAAK,OAAO,EAAE;gBACvC,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,SAAS,CAAC,CAAA;gBACnD,MAAM,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAS,CAAA;gBAEtD,IAAI,CAAC,MAAM,CAAC,MAAM,CAChB,kBAAkB,CAAC,GAAG,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,SAAS,CAAC,CAC/D,CAAA;aACF;YACD,OAAO,IAAI,CAAC,OAAO,CAAA;SACpB;QACD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC;YACjC,IAAI,EAAE,KAAK;SACZ,CAAC,CAAA;QACF,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,EAC/C,IAAI,EACJ,KAAK,CACN,CAAA;QACD,OAAO,IAAI,CAAA;IACb,CAAC;IAED;;;MAGE;IACF,+BAA+B,CAAC,KAAK;QACnC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE;YAC7B,OAAM;SACP;QACD,MAAM,kBAAkB,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;QACjE,IAAI,CAAC,kBAAkB,EAAE;YACvB,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAA;YAC/C,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAA;YAC5D,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAC3B,gBAAgB,CACd,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EACvB,IAAI,CAAC,OAAO,CAAC,WAAW,EACxB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,EACpB,OAAO,CACR,CAAC,CAAC,CAAC,CACL,CAAA;YACD,OAAO,IAAI,CAAC,OAAO,CAAC,WAAW,CAAA;SAChC;IACH,CAAC;IAED,eAAe,CAAC,MAAc,EAAE,KAAa,EAAE,GAAW;QACxD,KAAK,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,IAAI,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE;YACnD,MAAM,8BAA8B,GAClC,CAAC,IAAI,CAAC,KAAK,KAAK,GAAG,IAAI,IAAI,CAAC,GAAG,KAAK,KAAK,CAAC;gBAC1C,CAAC,IAAI,CAAC,KAAK,KAAK,KAAK,IAAI,IAAI,CAAC,GAAG,KAAK,GAAG,CAAC,CAAA;YAC5C,IAAI,8BAA8B,EAAE;gBAClC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAU,CAAA;aAC/B;SACF;QACD,OAAO,CAAC,IAAI,EAAE,IAAI,CAAU,CAAA;IAC9B,CAAC;CACF;AAED,eAAe,QAAQ,CAAA\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/editor/tool/bond.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Bond, Struct } from 'ketcher-core';\r\nimport Editor from '../Editor';\r\ndeclare class BondTool {\r\n    editor: Editor;\r\n    atomProps: {\r\n        label: string;\r\n    };\r\n    bondProps: any;\r\n    dragCtx: any;\r\n    isNotActiveTool: boolean | undefined;\r\n    constructor(editor: any, bondProps: any);\r\n    mousedown(event: any): true | undefined;\r\n    mousemove(event: any): true | undefined;\r\n    mouseup(event: any): boolean;\r\n    restoreBondWhenHoveringOnCanvas(event: any): void;\r\n    getExistingBond(struct: Struct, begin: number, end: number): readonly [number, Bond] | readonly [null, null];\r\n}\r\nexport default BondTool;\r\n"}}
