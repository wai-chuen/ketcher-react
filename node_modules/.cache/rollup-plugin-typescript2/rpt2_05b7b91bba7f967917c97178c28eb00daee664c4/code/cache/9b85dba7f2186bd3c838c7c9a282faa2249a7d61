{"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\r\n/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Dialog } from '../../../../components';\r\nimport { FormatterFactory, SupportedFormat } from 'ketcher-core';\r\nimport { MIEW_OPTIONS } from '../../../../../data/schema/options-schema';\r\nimport classes from './Miew.module.less';\r\nimport { connect } from 'react-redux';\r\nimport { load } from '../../../../../state';\r\nimport { pick } from 'lodash/fp';\r\nimport Viewer from 'miew-react';\r\nimport { useCallback, useRef } from 'react';\r\n/* OPTIONS for MIEW */\r\nconst BACKGROUND_COLOR = {\r\n    dark: '0x202020',\r\n    light: '0xcccccc'\r\n};\r\nconst MIEW_TX_TYPES = {\r\n    no: null,\r\n    bright: {\r\n        colorer: 'EL'\r\n    },\r\n    blackAndWhite: {\r\n        colorer: ['UN', { color: 0xffffff }],\r\n        bg: '0x000'\r\n    },\r\n    black: {\r\n        colorer: ['UN', { color: 0x000000 }]\r\n    }\r\n};\r\nconst TXoptions = (userOpts) => {\r\n    const type = userOpts.miewAtomLabel;\r\n    if (MIEW_TX_TYPES[type] === null)\r\n        return null;\r\n    return {\r\n        colorer: MIEW_TX_TYPES[type].colorer,\r\n        selector: 'not elem C',\r\n        mode: [\r\n            'TX',\r\n            {\r\n                bg: MIEW_TX_TYPES[type].bg || BACKGROUND_COLOR[userOpts.miewTheme],\r\n                showBg: true,\r\n                template: '{{elem}}'\r\n            }\r\n        ]\r\n    };\r\n};\r\nfunction createMiewOptions(userOpts) {\r\n    const options = {\r\n        settings: {\r\n            bg: { color: Number(BACKGROUND_COLOR[userOpts.miewTheme]) },\r\n            autoPreset: false,\r\n            editing: true,\r\n            inversePanning: true\r\n        },\r\n        reps: [\r\n            {\r\n                mode: userOpts.miewMode\r\n            }\r\n        ]\r\n    };\r\n    const textMode = TXoptions(userOpts);\r\n    if (textMode)\r\n        options.reps.push(textMode);\r\n    return options;\r\n}\r\n/* ---------------- */\r\nconst CHANGING_WARNING = 'Stereocenters can be changed after the strong 3D rotation';\r\nconst FooterContent = () => (_jsx(\"div\", { className: classes.warning, children: CHANGING_WARNING }));\r\nconst MiewDialog = ({ miewOpts, server, struct, onExportCML, miewTheme = 'light', ...prop }) => {\r\n    const miewRef = useRef();\r\n    const onMiewInit = useCallback((miew) => {\r\n        miewRef.current = miew;\r\n        const factory = new FormatterFactory(server);\r\n        const service = factory.create(SupportedFormat.cml);\r\n        service\r\n            .getStructureFromStructAsync(struct)\r\n            .then((res) => miew.load(res, { sourceType: 'immediate', fileType: 'cml' }))\r\n            .then(() => miew.setOptions(miewOpts))\r\n            .catch((ex) => console.error(ex.message));\r\n    }, [miewOpts, server, struct]);\r\n    const exportCML = useCallback(() => {\r\n        const cmlStruct = miewRef.current?.exportCML();\r\n        if (!cmlStruct) {\r\n            return;\r\n        }\r\n        onExportCML(cmlStruct);\r\n    }, [onExportCML, miewRef]);\r\n    return (_jsx(Dialog, { title: \"Miew\", needMargin: false, params: prop, buttons: [\r\n            'Cancel',\r\n            _jsx(\"button\", { onClick: exportCML, className: classes.applyButton, children: \"Apply\" }, \"apply\")\r\n        ], footerContent: _jsx(FooterContent, {}), className: classes.miewDialog, children: _jsx(\"div\", { children: _jsx(\"div\", { className: `${classes.miewContainer} ${miewTheme === 'dark' ? classes.miewDarkTheme : ''}`, children: _jsx(Viewer, { onInit: onMiewInit }) }) }) }));\r\n};\r\nconst mapStateToProps = (state) => ({\r\n    miewOpts: createMiewOptions(pick(MIEW_OPTIONS, state.options.settings)),\r\n    server: state.options.app.server ? state.server : null,\r\n    struct: state.editor.struct(),\r\n    miewTheme: state.options.settings.miewTheme\r\n});\r\nconst mapDispatchToProps = (dispatch) => ({\r\n    onExportCML: (cmlStruct) => {\r\n        dispatch(load(cmlStruct));\r\n        // TODO: Removed ownProps.onOk call. consider refactoring of load function in release 2.4\r\n        // See PR #731 (https://github.com/epam/ketcher/pull/731)\r\n    }\r\n});\r\nconst Miew = connect(mapStateToProps, mapDispatchToProps)(MiewDialog);\r\nexport default Miew;\r\n//# sourceMappingURL=Miew.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/components/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/data/schema/options-schema.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/react-redux/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/state/index.js","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/lodash/fp.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/miew-react/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/miew/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/react/index.d.ts"],"map":"{\"version\":3,\"file\":\"Miew.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../../../../src/script/ui/views/modal/components/process/Miew/Miew.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/ui/views/modal/components/process/Miew/Miew.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\n/// <reference types=\"react\" />\r\nimport { Struct, StructService } from 'ketcher-core';\r\ndeclare type MiewDialogProps = {\r\n    miewOpts: any;\r\n    server: StructService;\r\n    struct: Struct;\r\n    onCancel: () => void;\r\n    onOk: (result: any) => void;\r\n    miewTheme: 'dark' | 'light';\r\n};\r\ndeclare type MiewDialogCallProps = {\r\n    onExportCML: (cmlStruct: string) => void;\r\n};\r\ndeclare type Props = MiewDialogProps & MiewDialogCallProps;\r\ndeclare const Miew: import(\"react-redux\").ConnectedComponent<({ miewOpts, server, struct, onExportCML, miewTheme, ...prop }: Props) => JSX.Element, import(\"react-redux\").Omit<MiewDialogProps & MiewDialogCallProps, \"miewOpts\" | \"server\" | \"struct\" | \"onExportCML\" | \"miewTheme\">>;\r\nexport default Miew;\r\n"}}
