{"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\r\n/****************************************************************************\r\n * Copyright 2022 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { FunctionalGroup } from 'ketcher-core';\r\nimport { useCallback } from 'react';\r\nimport { useContextMenu } from 'react-contexify';\r\nimport { useAppContext } from 'src/hooks';\r\nimport { CONTEXT_MENU_ID } from './contextMenu.types';\r\nimport { onlyHasProperty } from './utils';\r\nconst ContextMenuTrigger = ({ children }) => {\r\n    const { getKetcherInstance } = useAppContext();\r\n    const { show } = useContextMenu();\r\n    const getSelectedFunctionalGroups = useCallback(() => {\r\n        const editor = getKetcherInstance().editor;\r\n        const struct = editor.struct();\r\n        const selectedAtomIds = editor.selection()?.atoms;\r\n        // Map could do deduplication\r\n        const selectedFunctionalGroups = new Map();\r\n        selectedAtomIds?.forEach((atomId) => {\r\n            const functionalGroup = FunctionalGroup.findFunctionalGroupByAtom(struct.functionalGroups, atomId, true);\r\n            functionalGroup !== null &&\r\n                selectedFunctionalGroups.set(functionalGroup.relatedSGroupId, functionalGroup);\r\n        });\r\n        return selectedFunctionalGroups;\r\n    }, [getKetcherInstance]);\r\n    const handleDisplay = useCallback((event) => {\r\n        event.preventDefault();\r\n        const editor = getKetcherInstance().editor;\r\n        const closestItem = editor.findItem(event, null);\r\n        const selection = editor.selection();\r\n        const functionalGroupsInSelection = getSelectedFunctionalGroups();\r\n        let showProps = null;\r\n        if (selection) {\r\n            if (functionalGroupsInSelection.size > 0) {\r\n                const functionalGroups = Array.from(functionalGroupsInSelection.values());\r\n                showProps = {\r\n                    id: CONTEXT_MENU_ID.FOR_FUNCTIONAL_GROUPS,\r\n                    functionalGroups\r\n                };\r\n            }\r\n            else if (onlyHasProperty(selection, 'bonds')) {\r\n                showProps = {\r\n                    id: CONTEXT_MENU_ID.FOR_BONDS,\r\n                    bondIds: selection.bonds\r\n                };\r\n            }\r\n            else if (onlyHasProperty(selection, 'atoms')) {\r\n                showProps = {\r\n                    id: CONTEXT_MENU_ID.FOR_ATOMS,\r\n                    atomIds: selection.atoms\r\n                };\r\n            }\r\n            else {\r\n                showProps = {\r\n                    id: CONTEXT_MENU_ID.FOR_SELECTION,\r\n                    bondIds: selection.bonds,\r\n                    atomIds: selection.atoms\r\n                };\r\n            }\r\n        }\r\n        else if (closestItem) {\r\n            const struct = editor.struct();\r\n            switch (closestItem.map) {\r\n                case 'bonds':\r\n                    {\r\n                        const functionalGroup = FunctionalGroup.findFunctionalGroupByBond(struct, struct.functionalGroups, closestItem.id, true);\r\n                        showProps =\r\n                            functionalGroup === null\r\n                                ? {\r\n                                    id: CONTEXT_MENU_ID.FOR_BONDS,\r\n                                    bondIds: [closestItem.id]\r\n                                }\r\n                                : {\r\n                                    id: CONTEXT_MENU_ID.FOR_FUNCTIONAL_GROUPS,\r\n                                    functionalGroups: [functionalGroup]\r\n                                };\r\n                    }\r\n                    break;\r\n                case 'atoms': {\r\n                    const functionalGroup = FunctionalGroup.findFunctionalGroupByAtom(struct.functionalGroups, closestItem.id, true);\r\n                    showProps =\r\n                        functionalGroup === null\r\n                            ? {\r\n                                id: CONTEXT_MENU_ID.FOR_ATOMS,\r\n                                atomIds: [closestItem.id]\r\n                            }\r\n                            : {\r\n                                id: CONTEXT_MENU_ID.FOR_FUNCTIONAL_GROUPS,\r\n                                functionalGroups: [functionalGroup]\r\n                            };\r\n                    break;\r\n                }\r\n                case 'sgroups':\r\n                case 'functionalGroups': {\r\n                    const sGroup = struct.sgroups.get(closestItem.id);\r\n                    const functionalGroup = FunctionalGroup.findFunctionalGroupBySGroup(struct.functionalGroups, sGroup);\r\n                    showProps = functionalGroup\r\n                        ? {\r\n                            id: CONTEXT_MENU_ID.FOR_FUNCTIONAL_GROUPS,\r\n                            functionalGroups: [functionalGroup]\r\n                        }\r\n                        : null;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        showProps &&\r\n            show({\r\n                id: showProps.id,\r\n                event,\r\n                props: showProps\r\n            });\r\n    }, [getKetcherInstance, getSelectedFunctionalGroups, show]);\r\n    return (_jsx(\"div\", { style: { height: '100%' }, onContextMenu: handleDisplay, children: children }));\r\n};\r\nexport default ContextMenuTrigger;\r\n//# sourceMappingURL=ContextMenuTrigger.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/react/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/react-contexify/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/hooks/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/components/ContextMenu/contextMenu.types.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/components/ContextMenu/utils.ts"],"map":"{\"version\":3,\"file\":\"ContextMenuTrigger.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../../src/script/ui/views/components/ContextMenu/ContextMenuTrigger.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/ui/views/components/ContextMenu/ContextMenuTrigger.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2022 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { PropsWithChildren } from 'react';\r\ndeclare const ContextMenuTrigger: React.FC<PropsWithChildren>;\r\nexport default ContextMenuTrigger;\r\n"}}
