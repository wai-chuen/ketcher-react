{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Vec2, fromItemsFuse, fromTemplateOnAtom, fromTemplateOnBondAction, fromTemplateOnCanvas, getHoverToFuse, getItemsToFuse, FunctionalGroup, SGroup, fromFragmentDeletion, fromPaste, fromSgroupDeletion, Action } from 'ketcher-core';\r\nimport utils from '../shared/utils';\r\nimport { getGroupIdsFromItemArrays } from './helper/getGroupIdsFromItems';\r\nimport { getMergeItems } from './helper/getMergeItems';\r\nclass TemplateTool {\r\n    editor;\r\n    mode;\r\n    template;\r\n    findItems;\r\n    mergeItems = null;\r\n    dragCtx;\r\n    targetGroupsIds = [];\r\n    isSaltOrSolvent;\r\n    followAction;\r\n    constructor(editor, tmpl) {\r\n        this.editor = editor;\r\n        this.mode = getTemplateMode(tmpl);\r\n        this.editor.selection(null);\r\n        this.isSaltOrSolvent = SGroup.isSaltOrSolvent(tmpl.struct.name);\r\n        this.template = {\r\n            aid: parseInt(tmpl.aid) || 0,\r\n            bid: parseInt(tmpl.bid) || 0\r\n        };\r\n        const frag = tmpl.struct;\r\n        frag.rescale();\r\n        const xy0 = new Vec2();\r\n        frag.atoms.forEach((atom) => {\r\n            xy0.add_(atom.pp); // eslint-disable-line no-underscore-dangle\r\n        });\r\n        this.template.molecule = frag; // preloaded struct\r\n        this.findItems = [];\r\n        this.template.xy0 = xy0.scaled(1 / (frag.atoms.size || 1)); // template center\r\n        const atom = frag.atoms.get(this.template.aid);\r\n        if (atom) {\r\n            this.template.angle0 = utils.calcAngle(atom.pp, this.template.xy0); // center tilt\r\n            this.findItems.push('atoms');\r\n        }\r\n        const bond = frag.bonds.get(this.template.bid);\r\n        if (bond && this.mode !== 'fg') {\r\n            // template location sign against attachment bond\r\n            this.template.sign = getSign(frag, bond, this.template.xy0);\r\n            this.findItems.push('bonds');\r\n        }\r\n        const sgroup = frag.sgroups.size;\r\n        if (sgroup) {\r\n            this.findItems.push('functionalGroups');\r\n        }\r\n    }\r\n    mousedown(event) {\r\n        if (this.followAction) {\r\n            this.followAction.perform(this.editor.render.ctab);\r\n            delete this.followAction;\r\n        }\r\n        const closestItem = this.editor.findItem(event, [\r\n            'atoms',\r\n            'bonds',\r\n            'sgroups',\r\n            'functionalGroups'\r\n        ]);\r\n        const ctab = this.editor.render.ctab;\r\n        const struct = ctab.molecule;\r\n        if (struct.functionalGroups.size) {\r\n            this.targetGroupsIds = getGroupIdsFromItemArrays(struct, {\r\n                ...(closestItem?.map === 'atoms' && { atoms: [closestItem.id] }),\r\n                ...(closestItem?.map === 'bonds' && { bonds: [closestItem.id] })\r\n            });\r\n            if (closestItem?.map === 'functionalGroups' &&\r\n                FunctionalGroup.isContractedFunctionalGroup(closestItem.id, struct.functionalGroups)) {\r\n                this.targetGroupsIds.push(closestItem.id);\r\n            }\r\n        }\r\n        this.editor.hover(null);\r\n        const dragCtxItem = getDragCtxItem(this.editor, event, this.mode, this.mergeItems, this.findItems);\r\n        this.dragCtx = {\r\n            xy0: this.editor.render.page2obj(event),\r\n            item: dragCtxItem\r\n        };\r\n        const dragCtx = this.dragCtx;\r\n        const ci = dragCtx.item;\r\n        if (!ci || this.isSaltOrSolvent) {\r\n            //  ci.type == 'Canvas'\r\n            delete dragCtx.item;\r\n            return;\r\n        }\r\n        if (ci.map === 'bonds' && this.mode !== 'fg') {\r\n            // calculate fragment center\r\n            const xy0 = new Vec2();\r\n            const bond = struct.bonds.get(ci.id);\r\n            const frid = struct.atoms.get(bond?.begin)?.fragment;\r\n            const frIds = struct.getFragmentIds(frid);\r\n            let count = 0;\r\n            let loop = struct.halfBonds.get(bond?.hb1)?.loop;\r\n            if (loop && loop < 0) {\r\n                loop = struct.halfBonds.get(bond?.hb2)?.loop;\r\n            }\r\n            if (loop && loop >= 0) {\r\n                const loopHbs = struct.loops.get(loop)?.hbs;\r\n                loopHbs?.forEach((hb) => {\r\n                    const halfBondBegin = struct.halfBonds.get(hb)?.begin;\r\n                    if (halfBondBegin) {\r\n                        const hbbAtom = struct.atoms.get(halfBondBegin);\r\n                        if (hbbAtom) {\r\n                            xy0.add_(hbbAtom.pp); // eslint-disable-line no-underscore-dangle, max-len\r\n                            count++;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                frIds.forEach((id) => {\r\n                    const atomById = struct.atoms.get(id);\r\n                    if (atomById) {\r\n                        xy0.add_(atomById.pp); // eslint-disable-line no-underscore-dangle\r\n                        count++;\r\n                    }\r\n                });\r\n            }\r\n            dragCtx.v0 = xy0.scaled(1 / count);\r\n            const sign = getSign(struct, bond, dragCtx.v0);\r\n            // calculate default template flip\r\n            dragCtx.sign1 = sign || 1;\r\n            dragCtx.sign2 = this.template.sign;\r\n        }\r\n    }\r\n    mousemove(event) {\r\n        if (!this.dragCtx) {\r\n            if (this.followAction) {\r\n                this.followAction.perform(this.editor.render.ctab);\r\n            }\r\n            const [followAction, pasteItems] = fromPaste(this.editor.render.ctab, this.template.molecule, this.editor.render.page2obj(event));\r\n            this.followAction = followAction;\r\n            this.editor.update(followAction, true);\r\n            if (this.mode === 'fg') {\r\n                const skip = getIgnoredGroupItem(this.editor.struct(), pasteItems);\r\n                const ci = this.editor.findItem(event, this.findItems, skip);\r\n                this.editor.hover(ci ?? null, null, event);\r\n            }\r\n            else {\r\n                this.mergeItems = getMergeItems(this.editor, pasteItems);\r\n                this.editor.hover(getHoverToFuse(this.mergeItems));\r\n            }\r\n            return;\r\n        }\r\n        const dragCtx = this.dragCtx;\r\n        const ci = dragCtx.item;\r\n        let targetPos = null;\r\n        const eventPos = this.editor.render.page2obj(event);\r\n        const struct = this.editor.render.ctab.molecule;\r\n        /* moving when attached to bond */\r\n        if (ci && ci.map === 'bonds' && this.mode !== 'fg') {\r\n            const bond = struct.bonds.get(ci.id);\r\n            let sign = getSign(struct, bond, eventPos);\r\n            if (dragCtx.sign1 * this.template.sign > 0) {\r\n                sign = -sign;\r\n            }\r\n            if (sign !== dragCtx.sign2 || !dragCtx.action) {\r\n                if (dragCtx.action) {\r\n                    dragCtx.action.perform(this.editor.render.ctab);\r\n                } // undo previous action\r\n                dragCtx.sign2 = sign;\r\n                const [action, pasteItems] = fromTemplateOnBondAction(this.editor.render.ctab, this.template, ci.id, this.editor.event, dragCtx.sign1 * dragCtx.sign2 > 0, false);\r\n                dragCtx.action = action;\r\n                this.editor.update(dragCtx.action, true);\r\n                dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n                this.editor.hover(getHoverToFuse(dragCtx.mergeItems));\r\n            }\r\n            return true;\r\n        }\r\n        /* end */\r\n        let extraBond = null;\r\n        // calc initial pos and is extra bond needed\r\n        if (!ci) {\r\n            //  ci.type == 'Canvas'\r\n            targetPos = dragCtx.xy0;\r\n        }\r\n        else if (ci.map === 'atoms' || ci.map === 'functionalGroups') {\r\n            const atomId = getTargetAtomId(struct, ci);\r\n            if (atomId !== undefined) {\r\n                const atom = struct.atoms.get(atomId);\r\n                targetPos = atom?.pp;\r\n                if (targetPos) {\r\n                    extraBond =\r\n                        this.mode === 'fg' ? true : Vec2.dist(targetPos, eventPos) > 1;\r\n                }\r\n            }\r\n        }\r\n        if (!targetPos) {\r\n            return true;\r\n        }\r\n        // calc angle\r\n        let angle = utils.calcAngle(targetPos, eventPos);\r\n        if (!event.ctrlKey) {\r\n            angle = utils.fracAngle(angle, null);\r\n        }\r\n        const degrees = utils.degrees(angle);\r\n        this.editor.event.message.dispatch({ info: degrees + 'ยบ' });\r\n        // check if anything changed since last time\r\n        if (\r\n        // eslint-disable-next-line no-prototype-builtins\r\n        dragCtx.hasOwnProperty('angle') &&\r\n            dragCtx.angle === degrees &&\r\n            // eslint-disable-next-line no-prototype-builtins\r\n            (!dragCtx.hasOwnProperty('extra_bond') ||\r\n                dragCtx.extra_bond === extraBond)) {\r\n            return true;\r\n        }\r\n        // undo previous action\r\n        if (dragCtx.action) {\r\n            dragCtx.action.perform(this.editor.render.ctab);\r\n        }\r\n        // create new action\r\n        dragCtx.angle = degrees;\r\n        let action = null;\r\n        let pasteItems;\r\n        if (!ci) {\r\n            const isAddingFunctionalGroup = this.template?.molecule?.sgroups.size;\r\n            if (isAddingFunctionalGroup) {\r\n                // skip, b/c we dont want to do any additional actions (e.g. rotating for s-groups)\r\n                return true;\r\n            }\r\n            ;\r\n            [action, pasteItems] = fromTemplateOnCanvas(this.editor.render.ctab, this.template, targetPos, angle);\r\n        }\r\n        else if (ci?.map === 'atoms' || ci?.map === 'functionalGroups') {\r\n            const atomId = getTargetAtomId(struct, ci);\r\n            [action, pasteItems] = fromTemplateOnAtom(this.editor.render.ctab, this.template, atomId, angle, extraBond);\r\n            dragCtx.extra_bond = extraBond;\r\n        }\r\n        dragCtx.action = action;\r\n        this.editor.update(dragCtx.action, true);\r\n        if (this.mode !== 'fg') {\r\n            dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n            this.editor.hover(getHoverToFuse(dragCtx.mergeItems));\r\n        }\r\n        // TODO: refactor after #2195 comes into effect\r\n        if (this.targetGroupsIds.length)\r\n            this.targetGroupsIds.length = 0;\r\n        return true;\r\n    }\r\n    mouseup(event) {\r\n        const dragCtx = this.dragCtx;\r\n        if (this.targetGroupsIds.length && this.mode !== 'fg') {\r\n            this.editor.event.removeFG.dispatch({ fgIds: this.targetGroupsIds });\r\n            return;\r\n        }\r\n        if (!dragCtx) {\r\n            return true;\r\n        }\r\n        delete this.dragCtx;\r\n        const restruct = this.editor.render.ctab;\r\n        const struct = restruct.molecule;\r\n        let ci = dragCtx.item;\r\n        const functionalGroups = struct.functionalGroups;\r\n        /* after moving around bond */\r\n        if (dragCtx.action && ci && ci.map === 'bonds' && this.mode !== 'fg') {\r\n            dragCtx.action.perform(restruct); // revert drag action\r\n            const promise = fromTemplateOnBondAction(restruct, this.template, ci.id, this.editor.event, dragCtx.sign1 * dragCtx.sign2 > 0, true);\r\n            promise.then(([action, pasteItems]) => {\r\n                const mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n                action = fromItemsFuse(restruct, mergeItems).mergeWith(action);\r\n                this.editor.update(action);\r\n            });\r\n            return true;\r\n        }\r\n        /* end */\r\n        let action, functionalGroupRemoveAction;\r\n        let pasteItems = null;\r\n        if (this.isSaltOrSolvent) {\r\n            addSaltsAndSolventsOnCanvasWithoutMerge(restruct, this.template, dragCtx, this.editor);\r\n            return true;\r\n        }\r\n        else if (ci?.map === 'functionalGroups' &&\r\n            FunctionalGroup.isContractedFunctionalGroup(ci.id, functionalGroups) &&\r\n            this.mode === 'fg' &&\r\n            this.targetGroupsIds.length) {\r\n            functionalGroupRemoveAction = new Action();\r\n            const struct = this.editor.struct();\r\n            const restruct = this.editor.render.ctab;\r\n            const functionalGroupToReplace = struct.sgroups.get(ci.id);\r\n            const attachmentAtomId = functionalGroupToReplace.getAttAtomId(struct);\r\n            const atomsWithoutAttachmentAtom = SGroup.getAtoms(struct, functionalGroupToReplace).filter((id) => id !== attachmentAtomId);\r\n            functionalGroupRemoveAction.mergeWith(fromSgroupDeletion(restruct, ci.id));\r\n            functionalGroupRemoveAction.mergeWith(fromFragmentDeletion(restruct, { atoms: atomsWithoutAttachmentAtom }));\r\n            ci = { map: 'atoms', id: attachmentAtomId };\r\n        }\r\n        if (!dragCtx.action) {\r\n            if (!ci) {\r\n                //  ci.type == 'Canvas'\r\n                ;\r\n                [action, pasteItems] = fromTemplateOnCanvas(restruct, this.template, dragCtx.xy0, 0);\r\n                dragCtx.action = action;\r\n            }\r\n            else if (ci.map === 'atoms') {\r\n                const degree = restruct.atoms.get(ci.id)?.a.neighbors.length;\r\n                let angle;\r\n                if (degree && degree > 1) {\r\n                    // common case\r\n                    angle = null;\r\n                }\r\n                else if (degree === 1) {\r\n                    // on chain end\r\n                    const atom = struct.atoms.get(ci.id);\r\n                    const neiId = atom && struct.halfBonds.get(atom.neighbors[0])?.end;\r\n                    const nei = (neiId || neiId === 0) && struct.atoms.get(neiId);\r\n                    angle = event.ctrlKey\r\n                        ? utils.calcAngle(nei?.pp, atom?.pp)\r\n                        : utils.fracAngle(utils.calcAngle(nei.pp, atom?.pp), null);\r\n                }\r\n                else {\r\n                    // on single atom\r\n                    angle = 0;\r\n                }\r\n                ;\r\n                [action, pasteItems] = fromTemplateOnAtom(restruct, this.template, ci.id, angle, this.mode === 'fg');\r\n                if (functionalGroupRemoveAction) {\r\n                    action = functionalGroupRemoveAction.mergeWith(action);\r\n                }\r\n                dragCtx.action = action;\r\n            }\r\n            else if (ci.map === 'bonds' && this.mode !== 'fg') {\r\n                const promise = fromTemplateOnBondAction(restruct, this.template, ci.id, this.editor.event, dragCtx.sign1 * dragCtx.sign2 > 0, true);\r\n                promise.then(([action, pasteItems]) => {\r\n                    if (this.mode !== 'fg') {\r\n                        const mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n                        action = fromItemsFuse(restruct, mergeItems).mergeWith(action);\r\n                        this.editor.update(action);\r\n                    }\r\n                });\r\n                return true;\r\n            }\r\n        }\r\n        this.editor.selection(null);\r\n        if (!dragCtx.mergeItems && pasteItems && this.mode !== 'fg') {\r\n            dragCtx.mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n        }\r\n        dragCtx.action = dragCtx.action\r\n            ? fromItemsFuse(restruct, dragCtx.mergeItems).mergeWith(dragCtx.action)\r\n            : fromItemsFuse(restruct, dragCtx.mergeItems);\r\n        const completeAction = dragCtx.action;\r\n        if (completeAction && !completeAction.isDummy()) {\r\n            this.editor.update(completeAction);\r\n        }\r\n        this.editor.hover(this.editor.findItem(event, this.findItems), null, event);\r\n        this.editor.event.showInfo.dispatch(null);\r\n        this.editor.event.message.dispatch({ info: false });\r\n        return true;\r\n    }\r\n    cancel(e) {\r\n        if (this.followAction) {\r\n            this.followAction.perform(this.editor.render.ctab);\r\n            delete this.followAction;\r\n        }\r\n        this.mouseup(e);\r\n    }\r\n    mouseleave(e) {\r\n        this.mouseup(e);\r\n    }\r\n}\r\nfunction addSaltsAndSolventsOnCanvasWithoutMerge(restruct, template, dragCtx, editor) {\r\n    const [action] = fromTemplateOnCanvas(restruct, template, dragCtx.xy0, 0);\r\n    editor.update(action);\r\n    editor.selection(null);\r\n    editor.hover(null);\r\n    editor.event.message.dispatch({\r\n        info: false\r\n    });\r\n}\r\nfunction getTemplateMode(tmpl) {\r\n    if (tmpl.mode)\r\n        return tmpl.mode;\r\n    if (['Functional Groups', 'Salts and Solvents'].includes(tmpl.props?.group))\r\n        return 'fg';\r\n    return null;\r\n}\r\nfunction getSign(molecule, bond, v) {\r\n    const begin = molecule.atoms.get(bond.begin).pp;\r\n    const end = molecule.atoms.get(bond.end).pp;\r\n    const sign = Vec2.cross(Vec2.diff(begin, end), Vec2.diff(v, end));\r\n    if (sign > 0) {\r\n        return 1;\r\n    }\r\n    if (sign < 0) {\r\n        return -1;\r\n    }\r\n    return 0;\r\n}\r\nfunction getTargetAtomId(struct, ci) {\r\n    if (ci.map === 'atoms') {\r\n        return ci.id;\r\n    }\r\n    if (ci.map === 'functionalGroups') {\r\n        const group = struct.sgroups.get(ci.id);\r\n        return group?.getAttAtomId(struct);\r\n    }\r\n}\r\nfunction getIgnoredGroupItem(struct, pasteItems) {\r\n    const groupId = struct.getGroupIdFromAtomId(pasteItems.atoms[0]);\r\n    return { map: 'functionalGroups', id: groupId };\r\n}\r\nfunction getDragCtxItem(editor, event, mode, mergeItems, findItems) {\r\n    if (mode === 'fg')\r\n        return editor.findItem(event, findItems);\r\n    if (mergeItems?.atoms.size === 1 && mergeItems.bonds.size === 0) {\r\n        // get ID of single dst (target) atom we are hovering over\r\n        return { map: 'atoms', id: mergeItems.atoms.values().next().value };\r\n    }\r\n    return null;\r\n}\r\nexport default TemplateTool;\r\n//# sourceMappingURL=template.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/shared/utils.js","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/Editor.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/tool/helper/getGroupIdsFromItems.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/editor/tool/helper/getMergeItems.ts"],"map":"{\"version\":3,\"file\":\"template.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/script/editor/tool/template.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/editor/tool/template.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport Editor from '../Editor';\r\ndeclare type MergeItems = Record<string, Map<unknown, unknown>> | null;\r\ndeclare class TemplateTool {\r\n    editor: Editor;\r\n    mode: any;\r\n    template: any;\r\n    findItems: Array<string>;\r\n    mergeItems: MergeItems;\r\n    dragCtx: any;\r\n    targetGroupsIds: Array<number>;\r\n    isSaltOrSolvent: boolean;\r\n    followAction: any;\r\n    constructor(editor: any, tmpl: any);\r\n    mousedown(event: any): void;\r\n    mousemove(event: any): true | undefined;\r\n    mouseup(event: any): true | undefined;\r\n    cancel(e: any): void;\r\n    mouseleave(e: any): void;\r\n}\r\nexport default TemplateTool;\r\n"}}
