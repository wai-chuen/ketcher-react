{"code":"import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\r\n/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport 'draft-js/dist/Draft.css';\r\nimport { Editor, EditorState, RichUtils, convertFromRaw, convertToRaw, getDefaultKeyBinding } from 'draft-js';\r\nimport { useCallback, useState, useRef, useEffect } from 'react';\r\nimport { Dialog } from '../../../components';\r\nimport { FontControl } from './FontControl';\r\nimport { SpecialSymbolsButton } from './SpecialSymbols/SpecialSymbolsButton';\r\nimport { TextButton } from './TextButton';\r\nimport { TextCommand } from 'ketcher-core';\r\nimport classes from './Text.module.less';\r\nimport { connect } from 'react-redux';\r\nimport createStyles from 'draft-js-custom-styles';\r\nconst { styles, customStyleFn } = createStyles(['font-size']);\r\nconst buttons = [\r\n    {\r\n        command: TextCommand.Bold,\r\n        name: 'text-bold'\r\n    },\r\n    {\r\n        command: TextCommand.Italic,\r\n        name: 'text-italic'\r\n    },\r\n    {\r\n        command: TextCommand.Superscript,\r\n        name: 'text-superscript'\r\n    },\r\n    {\r\n        command: TextCommand.Subscript,\r\n        name: 'text-subscript'\r\n    }\r\n];\r\nconst Text = (props) => {\r\n    const { formState, position, id } = props;\r\n    const rawContentState = props.content\r\n        ? JSON.parse(props.content)\r\n        : null;\r\n    const [editorState, setEditorState] = useState(EditorState.moveFocusToEnd(EditorState.createWithContent(convertFromRaw(rawContentState || { blocks: [], entityMap: {} }))));\r\n    const result = () => {\r\n        const content = editorState.getCurrentContent();\r\n        return {\r\n            content: content.hasText() ? JSON.stringify(convertToRaw(content)) : '',\r\n            position,\r\n            id\r\n        };\r\n    };\r\n    const keyBindingFn = (e) => {\r\n        if (e.key === 'Enter') {\r\n            e.stopPropagation();\r\n        }\r\n        return getDefaultKeyBinding(e);\r\n    };\r\n    const onContentChange = (state) => {\r\n        setEditorState(state);\r\n    };\r\n    const currentStyle = editorState.getCurrentInlineStyle();\r\n    const toggleStyle = useCallback((command) => {\r\n        let newEditorState = editorState;\r\n        switch (command) {\r\n            case TextCommand.Subscript: {\r\n                if (currentStyle.has(TextCommand.Superscript)) {\r\n                    newEditorState = RichUtils.toggleInlineStyle(newEditorState, TextCommand.Superscript);\r\n                }\r\n                break;\r\n            }\r\n            case TextCommand.Superscript: {\r\n                if (currentStyle.has(TextCommand.Subscript)) {\r\n                    newEditorState = RichUtils.toggleInlineStyle(newEditorState, TextCommand.Subscript);\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        newEditorState = RichUtils.toggleInlineStyle(newEditorState, command);\r\n        setEditorState(newEditorState);\r\n    }, [currentStyle, editorState]);\r\n    const customStyleMap = {\r\n        SUBSCRIPT: {\r\n            verticalAlign: 'sub',\r\n            transform: 'scale(0.7)',\r\n            transformOrigin: 'left'\r\n        },\r\n        SUPERSCRIPT: {\r\n            verticalAlign: 'super',\r\n            transform: 'scale(0.7)',\r\n            transformOrigin: 'left',\r\n            lineHeight: 0\r\n        }\r\n    };\r\n    const refEditor = useRef();\r\n    const setFocusInEditor = useCallback(() => {\r\n        refEditor.current.focus();\r\n    }, [refEditor]);\r\n    // set focut on component mount\r\n    useEffect(() => {\r\n        setFocusInEditor();\r\n    }, [setFocusInEditor]);\r\n    return (_jsxs(Dialog, { className: classes.textEditor, title: \"Text Editor\", params: props, result: result, valid: () => formState.form.valid, buttonsNameMap: { OK: 'Apply' }, buttons: ['Cancel', 'OK'], withDivider: true, children: [_jsxs(\"div\", { className: classes.controlPanel, onClick: setFocusInEditor, children: [buttons.map((button) => {\r\n                        return (_jsx(TextButton, { button: button, active: currentStyle.has(button.command), toggleStyle: toggleStyle }, button.name));\r\n                    }), _jsx(SpecialSymbolsButton, { editorState: editorState, setEditorState: setEditorState, styles: currentStyle }), _jsx(\"span\", { children: \"Font Size\" }), _jsx(FontControl, { editorState: editorState, setEditorState: setEditorState, styles: styles })] }), _jsx(\"span\", { children: \"Text:\" }), _jsx(Editor, { keyBindingFn: keyBindingFn, editorState: editorState, onChange: onContentChange, customStyleMap: customStyleMap, customStyleFn: customStyleFn, ref: refEditor })] }));\r\n};\r\nexport default connect((store) => ({ formState: store.modal }))(Text);\r\n//# sourceMappingURL=Text.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/draft-js/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/react/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/components/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/components/Dialog/Dialog.tsx","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/modal/components/Text/FontControl/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/modal/components/Text/SpecialSymbols/SpecialSymbolsButton.tsx","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/src/script/ui/views/modal/components/Text/TextButton/index.ts","/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/@types/react-redux/index.d.ts","/usr/local/google/home/waich/workspace/ketcher/node_modules/draft-js-custom-styles/build/index.js"],"map":"{\"version\":3,\"file\":\"Text.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../../../src/script/ui/views/modal/components/Text/Text.tsx\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/ui/views/modal/components/Text/Text.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\n/// <reference types=\"react\" />\r\nimport 'draft-js/dist/Draft.css';\r\nimport { DialogParams } from '../../../components/Dialog/Dialog';\r\ninterface TextProps extends DialogParams {\r\n    formState: any;\r\n    id?: any;\r\n    content: string;\r\n    position?: string;\r\n}\r\ndeclare const _default: import(\"react-redux\").ConnectedComponent<(props: TextProps) => JSX.Element, import(\"react-redux\").Omit<TextProps, \"formState\">>;\r\nexport default _default;\r\n"}}
