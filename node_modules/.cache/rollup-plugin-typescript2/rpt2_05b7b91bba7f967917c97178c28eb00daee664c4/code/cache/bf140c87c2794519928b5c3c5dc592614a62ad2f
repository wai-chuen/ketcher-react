{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Action, fromMultipleMove, fromTextCreation, fromTextDeletion, fromTextUpdating } from 'ketcher-core';\r\nclass TextTool {\r\n    editor;\r\n    dragCtx;\r\n    constructor(editor) {\r\n        this.editor = editor;\r\n        this.editor.selection(null);\r\n    }\r\n    mousedown(event) {\r\n        const render = this.editor.render;\r\n        const closestItem = this.editor.findItem(event, ['texts']);\r\n        this.editor.selection(null);\r\n        if (closestItem && closestItem.map === 'texts') {\r\n            this.editor.hover(null);\r\n            this.editor.selection({ texts: [closestItem.id] });\r\n            this.dragCtx = {\r\n                xy0: render.page2obj(event),\r\n                action: new Action()\r\n            };\r\n        }\r\n    }\r\n    mousemove(event) {\r\n        const render = this.editor.render;\r\n        if (this.dragCtx) {\r\n            if (this.dragCtx.action) {\r\n                this.dragCtx.action.perform(render.ctab);\r\n            }\r\n            this.dragCtx.action = fromMultipleMove(render.ctab, this.editor.selection() || {}, render.page2obj(event).sub(this.dragCtx.xy0));\r\n            this.editor.update(this.dragCtx.action, true);\r\n        }\r\n        else {\r\n            this.editor.hover(this.editor.findItem(event, ['texts']), null, event);\r\n        }\r\n    }\r\n    mouseup() {\r\n        if (this.dragCtx) {\r\n            this.editor.update(this.dragCtx.action);\r\n            delete this.dragCtx;\r\n        }\r\n        return true;\r\n    }\r\n    click(event) {\r\n        const render = this.editor.render;\r\n        const closestItem = this.editor.findItem(event, ['texts']);\r\n        this.editor.hover(null);\r\n        if (!closestItem) {\r\n            propsDialog(this.editor, null, render.page2obj(event), []);\r\n        }\r\n        return true;\r\n    }\r\n    dblclick(event) {\r\n        const closestItem = this.editor.findItem(event, ['texts']);\r\n        this.editor.hover(null);\r\n        if (closestItem.map === 'texts') {\r\n            propsDialog(this.editor, closestItem.id, closestItem.position, closestItem.pos);\r\n        }\r\n        return true;\r\n    }\r\n}\r\nfunction propsDialog(editor, id, position, pos) {\r\n    const struct = editor.render.ctab.molecule;\r\n    const text = id || id === 0 ? struct.texts.get(id) : null;\r\n    const origilContent = text ? text.content : '';\r\n    const res = editor.event.elementEdit.dispatch({\r\n        content: origilContent,\r\n        id,\r\n        position,\r\n        pos,\r\n        type: 'text'\r\n    });\r\n    res\r\n        .then(({ content }) => {\r\n        if (!id && id !== 0 && content) {\r\n            editor.update(fromTextCreation(editor.render.ctab, content, position, pos));\r\n        }\r\n        else if (!content) {\r\n            editor.update(fromTextDeletion(editor.render.ctab, id));\r\n        }\r\n        else if (content !== origilContent) {\r\n            editor.update(fromTextUpdating(editor.render.ctab, id, content));\r\n        }\r\n    })\r\n        .catch(() => null);\r\n}\r\nexport default TextTool;\r\n//# sourceMappingURL=text.js.map","references":["/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-core/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"text.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/script/editor/tool/text.ts\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;;;;;;;;6EAc6E;AAE7E,OAAO,EACL,MAAM,EAGN,gBAAgB,EAChB,gBAAgB,EAChB,gBAAgB,EAChB,gBAAgB,EACjB,MAAM,cAAc,CAAA;AAMrB,MAAM,QAAQ;IACZ,MAAM,CAAK;IACX,OAAO,CAAK;IAEZ,YAAY,MAAM;QAChB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;QACpB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;IAC7B,CAAC;IAED,SAAS,CAAC,KAAK;QACb,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA;QACjC,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;QAE1D,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAA;QAE3B,IAAI,WAAW,IAAI,WAAW,CAAC,GAAG,KAAK,OAAO,EAAE;YAC9C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;YACvB,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,CAAA;YAClD,IAAI,CAAC,OAAO,GAAG;gBACb,GAAG,EAAE,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC;gBAC3B,MAAM,EAAE,IAAI,MAAM,EAAE;aACrB,CAAA;SACF;IACH,CAAC;IAED,SAAS,CAAC,KAAK;QACb,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA;QAEjC,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;gBACvB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;aACzC;YAED,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,gBAAgB,CACpC,MAAM,CAAC,IAAI,EACX,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,IAAI,EAAE,EAC7B,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAC7C,CAAA;YACD,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;SAC9C;aAAM;YACL,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,CAAC,CAAA;SACvE;IACH,CAAC;IAED,OAAO;QACL,IAAI,IAAI,CAAC,OAAO,EAAE;YAChB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;YACvC,OAAO,IAAI,CAAC,OAAO,CAAA;SACpB;QACD,OAAO,IAAI,CAAA;IACb,CAAC;IAED,KAAK,CAAC,KAAK;QACT,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAA;QACjC,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;QAC1D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QAEvB,IAAI,CAAC,WAAW,EAAE;YAChB,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,EAAE,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,CAAA;SAC3D;QAED,OAAO,IAAI,CAAA;IACb,CAAC;IAED,QAAQ,CAAC,KAAK;QACZ,MAAM,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,OAAO,CAAC,CAAC,CAAA;QAC1D,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;QAEvB,IAAI,WAAW,CAAC,GAAG,KAAK,OAAO,EAAE;YAC/B,WAAW,CACT,IAAI,CAAC,MAAM,EACX,WAAW,CAAC,EAAE,EACd,WAAW,CAAC,QAAQ,EACpB,WAAW,CAAC,GAAG,CAChB,CAAA;SACF;QAED,OAAO,IAAI,CAAA;IACb,CAAC;CACF;AAED,SAAS,WAAW,CAClB,MAAW,EACX,EAAiB,EACjB,QAAc,EACd,GAAgB;IAEhB,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAA;IAC1C,MAAM,IAAI,GAAgB,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA;IACtE,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAA;IAE9C,MAAM,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC;QAC5C,OAAO,EAAE,aAAa;QACtB,EAAE;QACF,QAAQ;QACR,GAAG;QACH,IAAI,EAAE,MAAM;KACb,CAAC,CAAA;IAEF,GAAG;SACA,IAAI,CAAC,CAAC,EAAE,OAAO,EAAU,EAAE,EAAE;QAC5B,IAAI,CAAC,EAAE,IAAI,EAAE,KAAK,CAAC,IAAI,OAAO,EAAE;YAC9B,MAAM,CAAC,MAAM,CACX,gBAAgB,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,CAAC,CAC7D,CAAA;SACF;aAAM,IAAI,CAAC,OAAO,EAAE;YACnB,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,EAAG,CAAC,CAAC,CAAA;SACzD;aAAM,IAAI,OAAO,KAAK,aAAa,EAAE;YACpC,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,EAAG,EAAE,OAAO,CAAC,CAAC,CAAA;SAClE;IACH,CAAC,CAAC;SACD,KAAK,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAA;AACtB,CAAC;AAED,eAAe,QAAQ,CAAA\"}","dts":{"name":"/usr/local/google/home/waich/workspace/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/editor/tool/text.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\ndeclare class TextTool {\r\n    editor: any;\r\n    dragCtx: any;\r\n    constructor(editor: any);\r\n    mousedown(event: any): void;\r\n    mousemove(event: any): void;\r\n    mouseup(): boolean;\r\n    click(event: any): boolean;\r\n    dblclick(event: any): boolean;\r\n}\r\nexport default TextTool;\r\n"}}
